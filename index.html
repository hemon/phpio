<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>PHPIO by hemon</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">PHPIO</h1>
        <p class="header">Cross request trace for PHP,like google's dapper,twitter's zipkin. </p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/hemon/phpio/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/hemon/phpio/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/hemon/phpio">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/hemon">hemon</a></p>


      </header>
      <section>
        <h1>
<a name="phpio" class="anchor" href="#phpio"><span class="octicon octicon-link"></span></a>PHPIO</h1>

<p>Cross request trace for PHP,like google's dapper,twitter's zipkin.<br>
It's base on <a href="http://aop-php.github.com">AOP-PHP</a> extension. 
PHPIO is focus on trace IO operation, such like Curl, MySQL, Memcache, Redis, APC.<br>
It's easily write your own Hooker monitor function/class operation in 10 line code.</p>
<iframe id="demo" src="http://hemon.github.io/phpio/demo/index.html" width="100%" height="300"></iframe>
<p><a href="http://hemon.github.io/phpio/PHPIO.ppt">PPT(中文)</a></p>
<ul>
<li>Common<br>
connection's host and port, call trace, function args, response and error message.</li>
<li>MySQL, PDO<br>
record raw SQL query stirng and affected rows.</li>
<li>Curl<br>
record raw http header(request &amp; response), and reporting the full infomation of time,speed and size.</li>
<li>Memcached, Redis<br>
record key for operation, the real server where key is mapped to.</li>
<li>Exception, Error<br>
record errno and errmsg for Exception and Error.</li>
<li>Call Graph<br>
call graph is svg format, click map node redirect to source.</li>
<li>Source viewer<br>
you can see all your source code which been executed.</li>
<li>Cross Request Tracking<br>
A unique request_id is auto inject in Cookie for track http request from frontpage to webservice api,
just use a Redis logger can collecting logs from all your php web servers.</li>
</ul>
<h2>
<a name="install-aop-extension" class="anchor" href="#install-aop-extension"><span class="octicon octicon-link"></span></a>Install aop extension</h2>

<pre><code>pecl install aop-beta
</code></pre>

<pre><code>[aop]  
extension=aop.so 
</code></pre>

<p>if coredump ?<br>
1. change you aop extension version (the pecl version is stable than github)<br>
2. rebuild php</p>

<h2>
<a name="get-phpio" class="anchor" href="#get-phpio"><span class="octicon octicon-link"></span></a>get phpio</h2>

<p>download tarball  </p>

<pre><code>wget https://github.com/hemon/phpio/tarball/master -O phpio.tar.gz  
tar xvf phpio.tar.gz  
</code></pre>

<p>or git clone   </p>

<pre><code>git clone https://hemon@github.com/hemon/phpio
</code></pre>

<h2>
<a name="prepend-phpiophp" class="anchor" href="#prepend-phpiophp"><span class="octicon octicon-link"></span></a>prepend phpio.php</h2>

<p>php.ini  </p>

<pre><code>auto_prepend_file = /path/to/phpio/phpio.php  
</code></pre>

<p>php-fpm  </p>

<pre><code>php_admin_value[auto_prepend_file] = /path/to/phpio/phpio.php
</code></pre>

<h2>
<a name="start-profile" class="anchor" href="#start-profile"><span class="octicon octicon-link"></span></a>start profile</h2>

<p>run you php programs with param XDEBUG_PROFILE=1  </p>

<pre><code>$_REQUEST['XDEBUG_PROFILE']=1  
$_COOKIE['XDEBUG_PROFILE']=1  
$_SERVER['XDEBUG_PROFILE']=1  
</code></pre>

<p>for example : 
<a href="http://www.example.com/index.php?XDEBUG_PROFILE=1">http://www.example.com/index.php?XDEBUG_PROFILE=1</a> </p>

<p>recommand firfox addon <a href="https://addons.mozilla.org/firefox/addon/easy-xdebug-with-moveable-/">easy-xdebug</a>, it can auto append user defined cookie param in request(default is XDEBUG_PROFILE=1): </p>

<p>in php-cli mode, use <code>export</code> command to set param for $_SERVER </p>

<pre><code>export XDEBUG_PROFILE=1
</code></pre>

<h2>
<a name="view-profile" class="anchor" href="#view-profile"><span class="octicon octicon-link"></span></a>view profile</h2>

<p>make phpio/www is accessible:  </p>

<pre><code>http://localhost/phpio/www/  
</code></pre>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-279687-9");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
